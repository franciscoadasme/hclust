require "./spec_helper"

describe HClust::Primitive do
  it_linkages "using the average linkage",
    HClust::Primitive(HClust::Linkage::Average).new(fake_dism),
    [
      {6, 12, 0.00438361},
      {7, 16, 0.00989980},
      {1, 5, 0.01000643},
      {4, 11, 0.02448446},
      {9, 19, 0.04289943},
      {8, 15, 0.06546053},
      {0, 17, 0.09371079},
      {2, 26, 0.10683807},
      {3, 24, 0.15778664},
      {10, 22, 0.19199378},
      {14, 18, 0.19431562},
      {20, 30, 0.30008457},
      {21, 25, 0.40002371},
      {13, 27, 0.41638140},
      {29, 33, 0.48226727},
      {28, 31, 0.50471870},
      {32, 35, 0.54206384},
      {23, 34, 0.55586070},
      {36, 37, 0.58421305},
    ]

  it_linkages "using the centroid linkage",
    HClust::Primitive(HClust::Linkage::Centroid).new(fake_dism),
    [
      {6, 12, 0.00438361},
      {7, 16, 0.00989980},
      {1, 5, 0.01000643},
      {4, 11, 0.02448446},
      {9, 19, 0.04289943},
      {8, 15, 0.06546053},
      {0, 17, 0.09371079},
      {2, 26, 0.09602132},
      {3, 24, 0.15700758},
      {14, 18, 0.19431562},
      {10, 22, 0.23793682},
      {20, 29, 0.29342832},
      {13, 27, 0.42917931},
      {21, 25, 0.49293524},
      {30, 32, 0.50903908},
      {33, 34, 0.48952213},
      {31, 35, 0.47125069},
      {28, 36, 0.46145872},
      {23, 37, 0.52229896},
    ]

  it_linkages "using the complete linkage",
    HClust::Primitive(HClust::Linkage::Complete).new(fake_dism),
    [
      {6, 12, 0.00438361},
      {7, 16, 0.00989980},
      {1, 5, 0.01000643},
      {4, 11, 0.02448446},
      {9, 19, 0.04289943},
      {8, 15, 0.06546053},
      {0, 17, 0.09371079},
      {2, 26, 0.10791074},
      {3, 24, 0.17244431},
      {14, 18, 0.19431562},
      {10, 22, 0.33262575},
      {20, 29, 0.39489176},
      {13, 27, 0.53008770},
      {21, 23, 0.83009763},
      {25, 31, 0.83305493},
      {30, 32, 0.89854317},
      {33, 34, 0.89965013},
      {28, 35, 0.96252179},
      {36, 37, 0.98482197},
    ]

  it_linkages "using the median linkage",
    HClust::Primitive(HClust::Linkage::Median).new(fake_dism),
    [
      {6, 12, 0.00438361},
      {7, 16, 0.00989980},
      {1, 5, 0.01000643},
      {4, 11, 0.02448446},
      {9, 19, 0.04289943},
      {8, 15, 0.06546053},
      {0, 17, 0.09371079},
      {2, 26, 0.09602132},
      {3, 24, 0.15700758},
      {14, 18, 0.19431562},
      {10, 22, 0.23793682},
      {20, 29, 0.29342832},
      {13, 27, 0.43837737},
      {21, 25, 0.49293524},
      {31, 33, 0.50945330},
      {30, 34, 0.47801768},
      {32, 35, 0.47528491},
      {23, 36, 0.52481466},
      {28, 37, 0.57828193},
    ]

  it_linkages "using the single linkage",
    HClust::Primitive(HClust::Linkage::Single).new(fake_dism),
    [
      {6, 12, 0.00438361},
      {7, 16, 0.00989980},
      {1, 5, 0.01000643},
      {4, 11, 0.02448446},
      {9, 19, 0.04289943},
      {13, 24, 0.04747264},
      {10, 22, 0.05136181},
      {20, 26, 0.06133798},
      {8, 15, 0.06546053},
      {21, 27, 0.07880936},
      {0, 29, 0.07920459},
      {17, 30, 0.09371079},
      {25, 31, 0.09517504},
      {23, 32, 0.09733436},
      {2, 33, 0.10275691},
      {3, 34, 0.14312896},
      {14, 28, 0.16196269},
      {35, 36, 0.17977018},
      {18, 37, 0.19431562},
    ]

  it_linkages "using the ward linkage",
    HClust::Primitive(HClust::Linkage::Ward).new(fake_dism),
    [
      {6, 12, 0.00438361},
      {7, 16, 0.00989980},
      {1, 5, 0.01000643},
      {4, 11, 0.02448446},
      {9, 19, 0.04289943},
      {8, 15, 0.06546053},
      {0, 17, 0.09371079},
      {2, 26, 0.11087587},
      {3, 24, 0.18129673},
      {14, 18, 0.19431562},
      {10, 22, 0.27474577},
      {20, 29, 0.41497030},
      {13, 27, 0.52563515},
      {21, 25, 0.69711571},
      {23, 30, 0.85196219},
      {32, 34, 0.99555801},
      {28, 33, 1.00520421},
      {31, 36, 1.05456524},
      {35, 37, 1.27219489},
    ]

  it_linkages "using the weighted linkage",
    HClust::Primitive(HClust::Linkage::Weighted).new(fake_dism),
    [
      {6, 12, 0.00438361},
      {7, 16, 0.00989980},
      {1, 5, 0.01000643},
      {4, 11, 0.02448446},
      {9, 19, 0.04289943},
      {8, 15, 0.06546053},
      {0, 17, 0.09371079},
      {2, 26, 0.10683807},
      {3, 24, 0.15778664},
      {10, 22, 0.19199378},
      {14, 18, 0.19431562},
      {20, 30, 0.30008457},
      {21, 25, 0.40002371},
      {13, 27, 0.42932974},
      {29, 31, 0.52076127},
      {32, 33, 0.53821630},
      {28, 35, 0.56847827},
      {34, 36, 0.57194359},
      {23, 37, 0.63400984},
    ]
end

private def fake_dism
  HClust::DistanceMatrix.new [
    0.07920459, 0.10576539, 0.59606310, 0.61042315, 0.89854317,
    0.26471848, 0.62778115, 0.66097521, 0.82065438, 0.35405001,
    0.47365547, 0.78807079, 0.53008770, 0.67712605, 0.70490824,
    0.85656153, 0.09371079, 0.86581935, 0.89575505, 0.79537817,
    0.56384037, 0.11301959, 0.01000643, 0.06133798, 0.91606735,
    0.63248475, 0.19416327, 0.33262575, 0.56452808, 0.87404433,
    0.45179018, 0.35146467, 0.91782317, 0.61831115, 0.14014303,
    0.66480315, 0.29396925, 0.52918196, 0.28140770, 0.40735759,
    0.43062034, 0.47306752, 0.17977018, 0.90571691, 0.89135851,
    0.52333534, 0.95036536, 0.46817476, 0.65297875, 0.69938202,
    0.10275691, 0.10791074, 0.98118468, 0.33450688, 0.93868646,
    0.26712033, 0.23223071, 0.28849589, 0.88418213, 0.17244431,
    0.91151179, 0.58160926, 0.85215031, 0.96252179, 0.95819358,
    0.41094871, 0.75511802, 0.14984754, 0.88357233, 0.14312896,
    0.48166993, 0.47187630, 0.47704419, 0.47768977, 0.09733436,
    0.83322017, 0.02448446, 0.56035787, 0.63119763, 0.20845626,
    0.87217423, 0.56708328, 0.92444186, 0.75234932, 0.81825482,
    0.09110021, 0.07880936, 0.57394328, 0.62923937, 0.05136181,
    0.28684522, 0.29383987, 0.53677418, 0.45577395, 0.80180484,
    0.88536821, 0.26285555, 0.67135190, 0.25690961, 0.83766099,
    0.83305493, 0.88941401, 0.80286824, 0.67622712, 0.00438361,
    0.39273193, 0.39489176, 0.37086015, 0.28252687, 0.18007717,
    0.32551149, 0.14103609, 0.19298601, 0.19393896, 0.64260372,
    0.83009763, 0.77696419, 0.81747073, 0.82708782, 0.23190535,
    0.00989980, 0.74950020, 0.54703171, 0.22463276, 0.50135609,
    0.26526498, 0.79800767, 0.79736505, 0.95802987, 0.16196269,
    0.06546053, 0.89965013, 0.40713668, 0.33108291, 0.75207183,
    0.54472068, 0.75685058, 0.09517504, 0.44712091, 0.29732525,
    0.79054758, 0.41090643, 0.48110454, 0.29984471, 0.04289943,
    0.74234507, 0.36579309, 0.73326744, 0.79125403, 0.54198675,
    0.24156586, 0.23648481, 0.47431681, 0.80897081, 0.65274976,
    0.78445467, 0.84663188, 0.74129585, 0.63632525, 0.53150598,
    0.89909679, 0.75745557, 0.74290021, 0.18940851, 0.53817583,
    0.20140312, 0.83186367, 0.29052653, 0.13967871, 0.71836456,
    0.22859112, 0.34460232, 0.25088173, 0.24135205, 0.04747264,
    0.56469660, 0.53184141, 0.96253891, 0.19431562, 0.44893765,
    0.27555336, 0.74694716, 0.44474216, 0.26202300, 0.16438207,
    0.67228776, 0.98482197, 0.54051639, 0.82197362, 0.81906604,
  ]
end
